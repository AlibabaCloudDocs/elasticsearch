---
keyword: [logstash访问公网, 通过公网访问logstash]
---

# 配置NAT公网数据传输

本文介绍如何通过配置NAT网关，实现专有网络下的阿里云Logstash与公网连通。

您已完成以下操作：

-   创建专有网络和虚拟交换机。

    具体操作，请参见[搭建IPv4专有网络](/cn.zh-CN/快速入门/搭建IPv4专有网络.md)。

-   创建阿里云Logstash实例。

    具体操作，请参见[创建阿里云Logstash实例](/cn.zh-CN/Logstash/快速入门/步骤一：创建实例/创建阿里云Logstash实例.md)。


1.  登录[阿里云Elasticsearch控制台](https://elasticsearch.console.aliyun.com/#/home)。

2.  在左侧导航栏，单击**Logstash实例**。

3.  在顶部菜单栏处，选择地域，然后在**实例列表**中单击目标实例ID。

4.  在左侧导航栏，单击**网络与安全**。

5.  在**网络配置**区域，单击**前往配置NAT网关**。

    关于NAT网关的详细说明和配置流程，请参见[创建NAT网关实例](/cn.zh-CN/控制台操作指南/创建NAT网关实例.md)。其中DNAT条目适用于公网服务向Logstash节点推送数据；SNAT条目适用于Logstash主动访问公网。

6.  在NAT网关配置页面，创建NAT网关。

    创建NAT网关时，所选的区域和专有网络需要与阿里云Logstash保持一致。详细创建方法，请参见[步骤二：创建NAT网关](/cn.zh-CN/快速入门/使用SNAT访问公网.md)。

7.  绑定弹性公网IP。

    1.  单击NAT网关列表右侧**操作**列下的**![更多操作](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5026129951/p98649.png)** \> **绑定弹性公网IP**。

    2.  在**绑定弹性公网IP**页面，选择**从已有弹性公网IP中选择**。

        如果还没有EIP，可选择**新购弹性公网IP并绑定**，按照页面提示完成绑定。

    3.  选择可用的EIP，单击**确定**。

        **说明：** 一个NAT网关最多可绑定20个EIP（最多可绑定10个按流量计费的EIP，每个按流量计费的EIP的最大峰值不能超过200Mbps），您可以提交工单申请更多配额。

8.  创建DNAT条目。

    1.  在NAT网关列表中，单击对应网关右侧**操作**列下的**设置DNAT**。

    2.  在**DNAT条目列表**区域，单击**创建DNAT条目**。

    3.  在**创建DNAT条目**页面，填写相关参数。

        |参数|说明|
        |--|--|
        |**公网IP地址**|选择一个可用的公网IP。 **说明：** 用于创建SNAT条目的公网IP不能再用来创建DNAT条目。 |
        |**私网IP地址**|选择**自填**，输入Logstash的IP地址。可在Logstash的基本信息页面获取。|
        |**端口设置**|选择DNAT映射的方式：         -   **任意端口**：该方式属于IP映射，相当于为目标Logstash实例配置了一个弹性公网IP。任何访问该公网IP的请求，都将转发到目标Logstash实例上。
        -   **具体端口**：该方式属于端口映射，NAT网关会将指定协议和端口访问该公网IP的请求，转发到目标Logstash实例的指定端口上。

选择**具体端口**后，请根据业务需求输入**公网端口**（进行端口转发的外部端口）、**私网端口**（进行端口转发的内部端口）和**协议类型**（进行端口转发的协议类型）。 |
        |**条目名称**|输入DNAT条目的名称。 名称长度为2~128个字符，以大小写字母或中文开头， 可包含数字、下划线（\_）和短横线（-）。 |

    4.  单击**确定**，完成创建。

9.  创建SNAT条目。

    1.  返回NAT网关列表页面，单击对应网关右侧**操作**列下的**设置SNAT**。

    2.  在**SNAT条目列表**区域，单击**创建SNAT条目**。

    3.  在**创建SNAT条目**页面，单击**交换机粒度**，并填写相关参数。

        |参数|说明|
        |--|--|
        |**交换机**|选择Logstash所属的专有网络中的交换机。该交换机下所有ECS实例，都将通过SNAT功能进行公网访问。|
        |**公网IP地址**|选择用来提供互联网访问的公网IP，支持选择多个公网IP，多个公网IP构建SNAT IP地址池。 当选择多个公网IP地址配置SNAT IP地址池时，请确保每个公网IP地址加入到一个共享带宽中。详细信息，请参见[加入共享带宽](/cn.zh-CN/用户指南/管理按量计费实例/加入共享带宽.md)。 |

        更多参数的详细信息，请参见[创建SNAT实现访问公网服务](/cn.zh-CN/控制台操作指南/创建SNAT实现访问公网服务.md)。

    4.  单击**确定**，完成创建。


