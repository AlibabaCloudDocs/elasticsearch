# 规格容量评估 {#concept_dq4_bmk_zgb .concept}

在使用阿里云Elasticsearch（简称ES）之前，您需要优先评估阿里云ES的资源容量，包括磁盘容量、集群规格、shard大小和数量等。本文根据实际测试结果和用户使用经验，提供了相对通用的评估方法，供您参考。

## 适用磁盘类型 {#section_kms_pfl_zgb .section}

本文档主要适用于**存储类型**为**SSD云盘**的阿里云ES实例。

## 磁盘容量评估 {#section_khy_pfl_zgb .section}

影响阿里云ES集群磁盘空间大小的因素包括：

-   副本数量。至少1个副本。
-   索引开销。通常比源数据大10%（\_all等未计算）。
-   操作系统预留。默认操作系统会保留5%的文件系统供用户处理关键流程、系统恢复以及磁盘碎片等。
-   ES内部开销。段合并、日志等内部操作，预留20%。
-   安全阈值。通常至少预留15%的安全阈值。

根据以上因素得到`最小磁盘总大小 = 源数据大小 * 3.4`。计算方式如下：

``` {#codeblock_im6_2t3_d4c}
磁盘总大小 = 源数据 * (1 + 副本数量) * (1 + 索引开销) / (1 - Linux预留空间) / (1 - ES开销) / (1 - 安全阈值)
= 源数据 * (1 + 副本数量) * 1.7
= 源数据 * 3.4
```

**说明：** 

-   对于\_all这项参数，如果不需要在业务上使用，通常建议您禁止或者有选择性地添加。
-   如果您需要开启\_all参数的索引，磁盘容量的开销也会随之增大。根据测试结果和使用经验，建议在上述评估的基础上额外增加一半的空间。

    ``` {#codeblock_vki_701_h0q}
    磁盘总大小 = 源数据 * (1 + 副本数) * 1.7 * (1 + 0.5) 
    = 源数据 * 5.1
    ```


## 集群规格评估 {#section_ksh_qfl_zgb .section}

阿里云ES的单机规格在一定程度上限制了集群的能力，本文根据测试结果和使用经验给出如下建议。

-   集群最大节点数：`集群最大节点数 = 单节点CPU * 5`。
-   单节点最大数据量。

    使用场景不同，单节点最大承载数据量也会不同，具体如下。

    -   数据加速、查询聚合等场景：`单节点最大数据量 = 单节点Mem(G) * 10`。
    -   日志写入、离线分析等场景：`单节点最大数据量 = 单节点Mem(G) * 50`。
    -   通常情况：`单节点最大数据量 = 单节点Mem(G) * 30`。

|规格|最大节点数|单节点最大磁盘（查询）|单节点最大磁盘（日志）|单节点最大磁盘（通常）|
|--|-----|-----------|-----------|-----------|
|2C 4G|10|40 GB|200 GB|100 GB|
|2C 8G|10|80 GB|400 GB|200 GB|
|4C 16G|20|160 GB|800 GB|512 GB|
|8C 32G|40|320 GB|1.5 TB|1 TB|
|16C 64G|50|640 GB|2 TB|2 TB|

## shard评估 {#section_tjp_qfl_zgb .section}

shard大小和数量是影响ES集群稳定性和性能的重要因素之一。ES集群中任何一个索引都需要有一个合理的shard规划（默认为5个）。

-   建议在小规格节点下，单个shard大小不要超过30GB。对于更高规格的节点，单个shard大小不要超过50GB。
-   对于日志分析或者超大索引场景，建议单个shard大小不要超过100GB。
-   shard的个数（包括副本）要尽可能匹配节点数、等于节点数或者是节点数的整数倍。
-   通常建议单个节点上同一索引的shard个数不要超5个。

**说明：** 

由于不同用户在数据结构、查询复杂度、数据量大小、性能要求以及数据的变化等方面是不同的，所以本文的评估不一定适用于每一个用户，仅供参考。建议您在条件允许的情况下，可以通过实际的数据和使用场景测试出适合自己的集群规格容量规划。

您可以参考本文的内容，对集群的规格容量进行初始规划，并通过阿里云ES提供的弹性扩容功能，在实际使用时根据情况随时进行增加磁盘大小、扩容节点个数、升级节点规格等操作。

