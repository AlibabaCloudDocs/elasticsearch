---
keyword: [查看es监控信息, es监控指标, es集群状态]
---

# 查看集群监控

阿里云Elasticsearch为运行中的集群提供了多项监控指标（例如集群状态、集群查询QPS、节点CPU使用率、节点磁盘使用率等），用来监测集群的运行状况。您可以根据这些指标，实时了解集群的运行状况，及时处理潜在风险，保障集群稳定运行。本文介绍如何查看集群监控详情，以及各监控指标含义、异常原因和异常处理建议。

## 查看集群监控详情

1.  登录[阿里云Elasticsearch控制台](https://elasticsearch.console.aliyun.com/#/home)。
2.  在左侧导航栏，单击**Elasticsearch实例**。
3.  在顶部菜单栏处，选择资源组和地域，然后在**实例列表**中单击目标实例ID。
4.  在左侧导航栏，单击**集群监控**。
5.  在**集群监控**区域，单击监控时段，查看该时段内的监控详情。

    ![集群监控指标详情](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1946359951/p40163.png)

    您也可以单击**自定义**图标，选择**开始时间**和**结束时间**，单击**确定**，查看自定义时间段内的监控详情。

    ![自定义时段监控详情](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0946359951/p40162.png)

    **说明：** Elasticsearch实例的监控报警默认为开启状态，因此您可以在**集群监控**页面查看历史监控数据。目前只保留30天内的监控信息，并且提供分钟粒度的数据。

    集群的监控指标包含：

    -   [集群状态](#section_257_5v7_kqo)
    -   [集群查询QPS（Count/Second）](#section_w28_966_t74)
    -   [集群写入QPS（Count/Second）](#section_8s5_7uu_sup)
    -   [节点CPU使用率（%）](#section_tw6_6yw_u7q)
    -   [节点磁盘使用率（%）](#section_ab8_jy6_0pi)
    -   [节点HeapMemory使用率（%）](#section_axk_6d5_0h4)
    -   [节点load\_1m](#section_uk5_kmy_6zw)
    -   [FullGc次数（个）](#section_9au_gum_j3f)
    -   [Exception次数（个）](#section_982_0js_7uu)
    -   [快照状态](#section_e2d_sik_bnu)

## 集群状态

-   指标含义

    **集群状态**监控指标展示了集群的健康度，数值为0.00时表示正常。此监控指标必须配置，配置方法请参见[配置集群告警](/cn.zh-CN/Elasticsearch/集群监控报警/配置集群告警.md)。指标各数值的含义如下。

    |数值|颜色|状态|说明|
    |--|--|--|--|
    |2.00|红色|不是所有的主分片都可用。|表示该集群中某个或某几个索引的主分片丢失（unassigned）。|
    |1.00|黄色|所有主分片可用，但不是所有副本分片都可用。|表示该集群中某个或某几个索引的副本分片丢失（unassigned）。|
    |0.00|绿色|所有主分片和副本分片都可用。|表示该集群中的所有索引都很健康，不存在丢失（unassigned）的分片。|

    **说明：** 表中的颜色是指在实例的[基本信息](/cn.zh-CN/Elasticsearch/实例管理/查看实例的基本信息.md)页面所看到的集群状态的颜色。

-   指标异常原因

    监控期间，当指标数值不为0.00时，表示集群状态异常，常见原因如下：

    -   节点的CPU或HeapMemory使用率过高，甚至达到100%。
    -   节点的磁盘使用率过高（例如节点磁盘使用率超过85%），甚至达到100%。
    -   节点的load\_1m负载过高。
    -   集群中索引的健康度出现过非健康（非绿色）状态。
-   异常处理建议
    -   在[Kibana控制台](/cn.zh-CN/Elasticsearch/可视化控制/Kibana/登录Kibana控制台.md)的Monitoring页面查看监控信息，或者[查看实例的日志](/cn.zh-CN/Elasticsearch/查询日志.md)，获取问题的具体信息，并排查解决（例如索引占用内存太大，可删除一些索引）。
    -   对于磁盘使用率过高导致集群异常的情况，建议参见[集群磁盘使用率过高和read\_only问题的排查与处理方法]()排查解决。
    -   对于1核2GB规格的实例，遇到实例状态不正常的问题时，建议先按照1:4（CPU:Mem）的规格[升配集群](/cn.zh-CN/Elasticsearch/升降配实例/升配集群.md)，增大实例规格。升配后，如果状态依然异常，建议参见以上两种方案排查解决。

## 集群查询QPS（Count/Second）

**说明：** 如果**查询QPS**流量突增，可能引起CPU使用率、HeapMemory使用率或load\_1m负载过高，影响集群服务，请尽量避免这种情况。

指标含义

**集群查询QPS**监控指标展示了集群每秒执行的查询QPS数量，查询QPS数量与待查询索引的主分片个数有关。例如待查询索引有5个主分片，则一次查询请求对应5个QPS。

## 集群写入QPS（Count/Second）

**说明：** 如果**写入QPS**流量突增，可能引起CPU使用率、HeapMemory使用率或load\_1m负载过高，影响集群服务，请尽量避免这种情况。

指标含义

**集群写入QPS**监控指标展示了集群每秒写入文档的数量。具体说明如下：

-   如果1秒内，客户端向集群发送了1个只包含单个文档的写入请求，则对应1个写入QPS。如果1秒内发送了多个写入请求，则累加统计。
-   如果1秒内，通过\_bulk API在一个写入请求中批量写入了多个文档，则写入QPS参考该请求中批量推送的总文档个数。如果1秒内发送了多个\_bulk API批量写入请求，则累加统计。

## 节点CPU使用率（%）

-   指标含义

    **节点CPU使用率**监控指标展示了集群中各节点的CPU使用率百分比。当CPU使用率较高或接近100%时，会影响集群服务。

-   指标异常原因

    监控期间，当指标数值突增或波动较大时，服务异常，常见原因如下：

    -   **查询QPS**或**写入QPS**流量突增或波动较大。
    -   存在个别慢查询或慢写入请求。

        此情况下，查询和写入QPS流量波动较小或不明显，可在阿里云Elasticsearch控制台中的[日志查询](/cn.zh-CN/Elasticsearch/查询日志.md)页面，单击**searching慢日志**查看分析。

    -   集群中存在大量索引或总分片数量非常多。

        由于Elasticsearch会监控集群中的索引并写入日志，因此当总索引或总分片数量过多时，容易引起CPU或HeapMemory使用率过高，或load\_1m负载过高。

    -   在集群上执行过Merge操作。

        Merge操作会消耗CPU资源，对应节点的Segment Count会突降，可在[Kibana控制台](/cn.zh-CN/Elasticsearch/可视化控制/Kibana/登录Kibana控制台.md)中节点的Overview页面查看。

    -   执行过GC操作。

        GC操作会尝试释放内存（例如FULL GC），消耗CPU资源。可能会导致CPU使用率突增。

    -   执行过定时任务，例如数据备份或其他自定义任务。

## 节点磁盘使用率（%）

指标含义

**节点磁盘使用率**监控指标展示了集群中各节点的磁盘使用率百分比。建议将磁盘使用率报警阈值控制在75%以下，不要超过85%。否则默认数据节点的磁盘使用率可能会出现以下情况，影响集群服务。

|节点磁盘使用率|说明|
|-------|--|
|＞85%|新的shard无法分配。|
|＞90%|集群会尝试将节点中的shard，迁移到其他磁盘使用率较低的数据节点中。|
|＞95%|Elasticsearch会为集群中的每个索引强制设置`read_only_allow_delete`属性，此时索引将无法写入数据，只能读取和删除。|

**说明：** 强烈建议您配置该监控指标，以便在发生报警时，及时扩容磁盘和节点，或清理索引数据等，避免影响集群服务。

## 节点HeapMemory使用率（%）

-   指标含义

    **节点HeapMemory使用率**监控指标展示了集群中各节点的HeapMemory使用率百分比。当HeapMemory使用率较高或存在较大的内存对象时，会影响集群服务，也会自动触发GC操作。

-   指标异常原因

    监控期间，当指标数值突增或波动较大时，服务异常，常见原因如下：

    -   **查询QPS**或**写入QPS**流量突增或波动较大。
    -   存在个别慢查询或慢写入请求。

        此情况下，查询和写入QPS流量波动较小或不明显，可在阿里云Elasticsearch控制台中的[日志查询](/cn.zh-CN/Elasticsearch/查询日志.md)页面，单击**searching慢日志**查看分析。

    -   存在大量慢查询或慢写入请求。

        此情况下，查询和写入QPS流量波动较大或很明显，可在阿里云Elasticsearch控制台中的[日志查询](/cn.zh-CN/Elasticsearch/查询日志.md)页面，单击**indexing慢日志**查看分析。

    -   集群中存在大量索引或总分片数量非常多。

        由于Elasticsearch会监控集群中的索引并写入日志，因此当总索引或总分片个数过多时，容易引起CPU或HeapMemory使用率过高，或load\_1m负载过高。

    -   在集群上执行过Merge操作。

        Merge操作会消耗CPU资源，对应节点的Segment Count会突降，可在[Kibana控制台](/cn.zh-CN/Elasticsearch/可视化控制/Kibana/登录Kibana控制台.md)中节点的**Overview**页面查看。

    -   执行过GC操作。

        GC操作会尝试释放内存（例如FULL GC），消耗CPU资源。可能会导致HeapMemory使用率突降。

    -   执行过定时任务，例如数据备份或其他自定义任务。

## 节点load\_1m

-   指标含义

    **节点load\_1m**监控指标展示了集群中各节点在1分钟内的负载情况，表示各节点的系统繁忙程度。该指标的正常数值，应该低于对应节点规格的CPU核数。以单核的Elasticsearch节点为例，指标各数值的含义如下。

    |节点load\_1m|说明|
    |----------|--|
    |<1|没有等待的进程。|
    |＝1|系统无额外的资源运行更多的进程。|
    |＞1|进程拥堵，等待资源。|

-   指标异常原因

    监控期间，当指标数值超过节点规格的CPU核数时，服务异常，常见原因如下：

    -   节点的CPU或HeapMemory使用率过高，甚至达到100%。
    -   **查询QPS**或**写入QPS**流量突增或上涨较大。
    -   存在耗时较大的慢查询。

        可在阿里云Elasticsearch控制台中的[日志查询](/cn.zh-CN/Elasticsearch/查询日志.md)页面，打开对应日志查看分析。


## FullGc次数（个）

**说明：** 当系统出现频繁FULL GC时，会影响集群服务。

-   指标含义

    **FullGc次数**监控指标展示了集群中1分钟内的GC总次数。

-   指标异常原因

    监控期间，当指标数值不为0时，服务异常，常见原因如下：

    -   HeapMemory使用率较高。
    -   存在较大的内存对象。

## Exception次数（个）

-   指标含义

    **Exception次数**监控指标展示了集群的主日志中，一分钟内出现的警告级别日志的总个数。

-   指标异常原因

    监控期间，当指标数值不为0时，服务异常，常见原因如下：

    -   查询请求可能存在异常。
    -   写入请求可能存在异常。
    -   Elasticsearch执行任务时，遇到异常。
    -   执行过GC操作。
-   异常处理建议

    可在阿里云Elasticsearch控制台中的[日志查询](/cn.zh-CN/Elasticsearch/查询日志.md)页面，单击**主日志**。在**主日志**页面，根据时间点查看详细异常信息，并分析异常原因。

    **说明：** 如果**主日志**中有GC记录，也会在**Exception次数**监控指标中统计展示。


## 快照状态

-   指标含义

    **快照状态**监控指标展示了Elasticsearch控制台中，[自动备份](/cn.zh-CN/Elasticsearch/数据备份/自动备份与恢复.md)功能的快照状态。当指标数值为-1或0时，表示服务正常。指标各数值的含义如下。

    |快照状态|说明|
    |----|--|
    |0|有快照。|
    |-1|没有快照。|
    |1|正在进行快照。|
    |2|快照任务失败。|

-   指标异常原因

    指标数值为2时，服务异常，常见原因如下：

    -   节点磁盘使用率很高或接近100%。
    -   集群不健康。

