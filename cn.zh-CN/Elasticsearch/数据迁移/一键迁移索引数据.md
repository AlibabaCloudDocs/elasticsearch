---
keyword: [迁移Elasticsearch索引, 一键索引迁移]
---

# 一键迁移索引数据

为了快速实现自建Elasticsearch集群迁移上云、集群索引重建（reindex）和跨集群数据迁移，阿里云Elasticsearch提供了一键索引迁移功能。本文介绍一键索引迁移功能的应用场景及使用方法。

## 前提条件

已创建满足条件的源和目标端Elasticsearch集群：源端为6.7.0版本的自建或阿里云Elasticsearch集群，目标端为6.3.2或6.7.0版本的阿里云Elasticsearch集群。

创建阿里云Elasticsearch集群的具体操作，请参见[创建阿里云Elasticsearch实例](/cn.zh-CN/Elasticsearch/实例管理/创建阿里云Elasticsearch实例.md)。

## 使用限制

阿里云Elasticsearch集群需要满足以下条件，才会显示一键索引迁移功能入口：

-   版本：6.3.2或6.7.0版本
-   地域：华北2（北京）地域

**说明：** 如果您的集群不满足限制条件，可使用其他方式迁移数据。详细信息，请参见[迁移方案选取指南](/cn.zh-CN/最佳实践/Elasticsearch迁移/迁移方案选取指南.md)。

## 应用场景

-   同集群索引重建（reindex）。支持修改索引的主分片数量和Mapping。
-   阿里云Elasticsearch集群间，批量或单个索引迁移。
-   自建Elasticsearch集群与阿里云Elasticsearch集群间，批量或单个索引迁移。

## 操作步骤

1.  登录[阿里云Elasticsearch控制台](https://elasticsearch.console.aliyun.com/#/home)。

2.  在左侧导航栏，单击**Elasticsearch实例**。

3.  进入目标实例。

    1.  在顶部菜单栏处，选择资源组和地域。

    2.  在左侧导航栏单击**Elasticsearch实例**，然后在**Elasticsearch实例**中单击目标实例ID。

4.  在**基本信息**页面，选择右上角的**一键索引迁移** \> **创建迁移任务**。

    阿里云Elasticsearch集群需要满足以下条件，才会显示一键索引迁移功能入口：

    -   版本：6.3.2或6.7.0版本
    -   地域：华北2（北京）地域
5.  在**一键索引迁移**页面，选择源和目标Elasticsearch集群。

    ![选择源和目标端集群](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2646359951/p136452.png)

    所选**迁移方式**不同，源端集群的要求不同，具体如下。

    **说明：** 目标端集群为当前集群，集群ID和版本（仅支持6.3.2和6.7.0）不可变更，仅需填入用户名和密码。在配置时，需要重点关注源端。

    -   **从现有阿里云Elasticsearch集群迁移**

        |参数|说明|
        |--|--|
        |**选择源集群**|选择与目标端集群在同一专有网络下的阿里云Elasticsearch实例的ID。|
        |**源集群版本**|仅支持6.7.0版本。|
        |**用户名**|阿里云Elasticsearch的用户名仅支持elastic。|
        |**密码**|elastic用户的密码。一般在创建实例时设定，如果忘记可重置，详情请参见[重置实例访问密码](/cn.zh-CN/Elasticsearch/安全配置/重置实例访问密码.md)。|

    -   **从自建Elasticsearch集群迁移**

        **集群类型**不同，需要配置的参数不同。当**集群类型**为**专有网络下的自建集群**时，源端集群需要选择与目标端集群在同一区域中，任意专有网路下的自建或阿里云Elasticsearch集群（仅支持6.7.0版本）；当**集群类型**为**开启公网访问的自建集群**时，源端集群需要选择任意公网网络下的自建或阿里云Elasticsearch集群（仅支持6.7.0版本）。详细参数说明如下。

        |集群类型|参数|说明|
        |----|--|--|
        |**专有网络下的自建集群**|**所在区域**|集群所在区域，需要与目标端实例保持一致。|
        |**专有网络**|集群所在的专有网络ID。不需要与目标端实例保持一致。|
        |**源集群访问IP**|专有网络下，集群中任一节点的IP地址，例如192.168.xx.xx。|
        |**端口**|集群的访问端口，例如9200。|
        |**用户名（选填）**|如果自建Elasticsearch集群开启了用户登录认证，则需要输入用户名和密码。|
        |**密码（选填）**|对应用户的密码。|
        |**开启公网访问的自建集群**|**源集群公网访问地址**|集群的公网访问地址，例如http://10.37.xx.xx:9200。如果为阿里云Elasticsearch集群，需要配置为http://<集群的外网地址\>:9200。|
        |**用户名（选填）**|如果自建Elasticsearch集群开启了用户登录认证，则需要输入用户名和密码。|
        |**密码（选填）**|对应用户的密码。|

    选择了源端和目标端集群后，您可以进行连通性测试。如果不通过，可以从以下几方面排查：

    -   如果源端是阿里云ECS上自建的Elasticsearch集群，需要检查阿里云ECS实例的安全组是否对外开放9200端口。如果没有开放，请参见[添加安全组规则](/cn.zh-CN/安全/安全组/添加安全组规则.md)，开放9200端口。
    -   检查源端和目标端集群的白名单是否有限制。如果有限制，请取消限制或修改白名单配置。具体操作，请参见[配置Elasticsearch公网或私网访问白名单](/cn.zh-CN/Elasticsearch/安全配置/配置Elasticsearch公网或私网访问白名单.md)。
    -   阿里云Elasticsearch的用户名仅支持elastic，请检查用户名、密码是否配置正确。

        **说明：** 如果自建Elasticsearch集群开启了用户登录认证（即用户必须通过用户名和密码认证，才被允许访问集群。无论是通过Kibana、客户端还是API等方式访问集群，都需要经过认证），则需要输入用户名和密码，否则可能导致迁移任务失败。

6.  单击**下一步**，配置索引迁移任务。

    ![配置索引迁移任务](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3646359951/p136481.png)

    |参数|说明|
    |--|--|
    |**选择源索引和Type**|选择待迁移的索引和索引类型。|
    |**创建目标索引和Type**|填入目标索引的名称和类型。请确保目标集群中不存在同名索引。|
    |**自定义Routing**|支持自定义路由字段。不填时，[\_routing](https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-routing-field.html)默认使用主键字段。|
    |**Mapping配置**|默认读取源索引的Mapping配置。可自定义修改索引类型、属性的名称和类型等。**说明：** 如果您修改了目标索引类型，需要在Mapping中同步修改，否则会报错**SinkTypenameNotMatchMappings**。 |
    |**Settings配置**|默认读取源索引的Settings配置。可自定义修改索引的主分片和副本分片数等。|

    **说明：** 您也可以单击**添加索引迁移任务**，添加多个索引迁移任务。添加后，可单击**删除**，删除对应的索引迁移任务。

7.  单击**提交**。

8.  查看索引迁移任务的详细信息。

    1.  在**基本信息**页面，选择**一键索引迁移** \> **查看任务**。

    2.  在**索引构建任务列表**对话框中，查看迁移任务的执行状态、进度、日志等。

        **索引构建任务列表**中，展示所有已完成和正在进行中的任务的详细信息。可单击**查看日志**查看任务的详细日志。

        ![查看迁移任务信息](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3646359951/p136558.png)


