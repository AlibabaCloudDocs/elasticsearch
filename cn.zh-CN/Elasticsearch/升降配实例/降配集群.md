# 降配集群

当您的业务存在高低峰期或其他变化，导致集群节点规格高于业务所需规格时，可通过阿里云Elasticsearch的集群降配功能，降低节点规格配置、变更节点磁盘类型等，以更好地保障业务发展并控制成本。本文介绍阿里云Elasticsearch降配集群的操作方法、相关说明和注意事项。

-   确保集群为正常（绿色）状态。
-   [登录Kibana控制台](/cn.zh-CN/Elasticsearch/可视化控制/Kibana/登录Kibana控制台.md)，执行以下命令，检查集群中是否存在状态为close的索引。如果存在，需要open或delete对应索引，否则变更不成功。
    -   查看索引状态

        ```
        GET /_cat/indices?v
        ```

        ![查看索引状态](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7521954161/p244657.png)

    -   open状态为close的索引

        ```
        POST /<index_name>/_open
        ```

    -   delete状态为close的索引

        **警告：** 索引删除后不可恢复，请谨慎操作。

        ```
        DELETE /<index_name>
        ```


## 使用限制

节点磁盘空间和Kibana节点规格，不支持降配操作。

## 注意事项

-   降配集群会触发集群重启，重启时间与集群规格、数据结构和大小等因素有关。一般情况下，重启耗时较长，在小时级别。为了减少降配对业务影响，建议在业务低峰期操作。详细信息，请参见[重启实例或节点](/cn.zh-CN/Elasticsearch/实例管理/重启实例或节点.md)。

    **说明：**

    -   如果集群索引存在副本分片且集群负载处于正常水平（CPU使用率在60%左右，堆内存使用率在50%左右，load\_1m低于CPU核数），一般情况下，在集群变更过程中可持续对外提供服务。
    -   如果集群负载过高且索引没有副本，同时在升配或者降配过程中存在大量的写入或查询等情况，业务可能会出现偶发的访问超时现象。建议在集群变更前，在客户端访问机制中配置重试机制，以减小对业务的影响。
-   请结合[规格容量评估](/cn.zh-CN/Elasticsearch/快速购买/规格容量评估.md)和[降配条件](#section_hmw_quu_exd)，确保降配后集群有足够的存储空间。如果降配后集群负载较高，建议及时升配，具体操作请参见[升配集群](/cn.zh-CN/Elasticsearch/升降配实例/升配集群.md)。
-   对于非标准规格的集群，例如集群仅有两个数据节点，降配可能导致额外的风险（例如数据丢失），请谨慎操作。

## 降配条件

集群需满足以下条件才可降配：

-   操作时间间隔

    对于同一集群，两次降配操作时间间隔不得少于30分钟。

-   集群负载

    集群中可能包含多种类型的节点。节点类型不同，当前CPU使用率和JVM堆内存使用率的要求不同，具体如下。

    |节点类型|当前CPU使用率|当前JVM堆内存使用率|
    |----|--------|-----------|
    |专有主节点|单节点最大值 < 30%|单节点最大值 < 25%|
    |数据节点|同时满足以下条件：    -   单节点最大值 < 60%
    -   所有节点平均值 < 40%
|同时满足以下条件：    -   单节点最大值 < 50%
    -   所有节点平均值 < 30% |
    |协调节点|同时满足以下条件：    -   单节点最大值 < 50%
    -   所有节点平均值 < 30%
|同时满足以下条件：    -   单节点最大值 < 50%
    -   所有节点平均值 < 30% |
    |冷数据节点|同时满足以下条件：    -   单节点最大值 < 60%
    -   所有节点平均值 < 40%
|同时满足以下条件：    -   单节点最大值 < 50%
    -   所有节点平均值 < 30% |

-   规格

    降配所选的目标规格的CPU和内存，均需大于或等于当前规格的1/2。


## 操作步骤

1.  登录[阿里云Elasticsearch控制台](https://elasticsearch.console.aliyun.com/#/home)。

2.  在左侧导航栏，单击**Elasticsearch实例**。

3.  在顶部菜单栏，选择资源组和地域。

4.  在实例列表中，选择目标实例右侧**操作**列下的**更多** \> **降配**。

5.  选择待降配的节点类型，单击**修改**。

6.  在展开的节点配置中，修改节点的规格或存储类型。

    ![降配](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2768181161/p233265.png)

    **说明：**

    -   系统只展示可变更的规格。
    -   每次只能变更一种节点类型的配置，同时支持同一类型节点的多种变更。例如支持变更数据节点规格的同时，变更其存储类型。
7.  查看并勾选服务协议和风险提示，单击**立即购买**。

    购买后，集群会重启，重启成功后即可完成集群降配。


