# 临时访问令牌 {#task_1614631 .task}

本文档为您介绍使用临时访问令牌STS（Security Token Service，它是RAM的一个扩展授权服务）给临时用户授权的方法。

进行操作前，请确保您已经注册了阿里云账号。如还未注册，请先完成[账号注册](https://account.aliyun.com/register/register.html)。

账号注册成功后，请使用该账号登录[RAM控制台](https://ram.console.aliyun.com/)。

有时存在一些用户（人或应用程序），并不经常访问您的云资源，只是偶尔需要访问一次，称这些用户为临时用户。您可以通过STS来为这些用户（子账号）颁发访问令牌。颁发令牌时，您可以根据需要来定义令牌的权限和自动过期时间。

使用STS访问令牌，给临时用户授权的好处是让授权更加可控。您不必为临时用户创建一个RAM用户账号及密钥，因为RAM用户密钥都是长期有效的，但临时用户并不需要长期的资源访问。具体使用场景可参见[针对移动设备应用的临时授权](../../cn.zh-CN/教程/移动设备应用使用临时安全令牌访问阿里云.md#) 和[跨云账号的资源授权](../../cn.zh-CN/教程/跨云账号的资源授权.md#)。

## 创建可信实体为阿里云账号的RAM角色 {#section_m2d_91y_434 .section}

1.  在左侧导航栏，单击**RAM角色管理**。
2.  单击**新建RAM角色**，选择可信实体类型为**阿里云账号**，单击**下一步**。
3.  输入**角色名称**和**备注**。
4.  **选择云账号**为**当前云账号**或**其他云账号**。 

    **说明：** 若选择**其他云账号**，需要填写其他云账号的ID。

5.  单击**完成**。

## 临时访问授权 {#section_h7a_w5d_xxn .section}

在使用STS来授权访问前，需要先对上文[创建RAM角色](#section_m2d_91y_434)第三步中的受信云账号的子账号进行扮演角色的授权。若任意子账号都可以扮演这些角色，会带来不可预估的风险，因此有扮演对应角色需求的子账号需要被赋予相应的配置权限，具体操作方式如下。

1.  [创建自定义策略](#section_r46_idi_h2v)。
2.  [为RAM用户授权](#section_27g_soq_f1b)。
3.  [使用RAM角色](#section_s7z_m33_zny)。

## 创建自定义策略 {#section_r46_idi_h2v .section}

1.  在左侧导航栏的**权限管理**菜单下，单击**权限策略管理**。
2.  单击**新建权限策略**。
3.  填写**策略名称**和**备注**。
4.  **配置模式**选择**脚本配置**。
5.  在**策略内容**脚本编辑区域输入如下脚本内容。 

    ``` {#codeblock_9hz_nxk_njr}
    {
    "Version": "1",
    "Statement": [
    {
       "Effect": "Allow",
       "Action": "sts:AssumeRole",
       "Resource": "acs:ram::${aliyunID}:role/${roleName}"
    }
    ]
    }
    ```

    **说明：** `Resource`的具体内容，可以从**RAM角色管理** \> **基本信息**页面的**ARN**中获取。

    ![获取Resource信息](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/134307/156888405940213_zh-CN.png)

    -   `${aliyunID}`：表示创建角色的用户ID。
    -   `${roleName}`：表示角色名称的小写。
6.  单击**确定**。

**说明：** 自定义策略创建成功后，您还需要在用户管理页面，对子账号授权上文中已经创建的扮演角色的权限，详情请参见下文的[为RAM用户授权](#section_27g_soq_f1b)。

## 为RAM用户授权 {#section_27g_soq_f1b .section}

1.  在左侧导航栏的**人员管理**菜单下，单击**用户**。
2.  在**用户登录名称/显示名称**列表下，找到目标RAM用户。
3.  单击**添加权限**，被授权主体会自动填入。
4.  在左侧**权限策略名称**列表下，单击需要授予RAM用户的权限策略。 

    **说明：** 在右侧区域框，选择某条策略并单击**×**，可撤销该策略。

5.  单击**确定**。
6.  单击**完成**。

## 使用RAM角色 {#section_s7z_m33_zny .section}

为了安全起见，阿里云不允许受信云账号以自己的身份扮演角色，如果一个实体用户想扮演某个RAM角色，该实体用户必须先以自己身份登录，然后将自己从实体身份切换到RAM角色身份。

子账号登录控制台后，可以切换到刚刚被授予扮演的角色，行使角色的权限，步骤如下。

1.  将鼠标悬停在右上角头像的位置，单击**切换身份**。
2.  在角色切换页面，输入相应**企业别名/默认域名**以及**角色名**。
3.  单击**切换**。 

    **说明：** 切换成功后，用户将以RAM角色身份登录控制台，控制台右上角头像位置将显示角色身份（即当前身份）和登录身份，此时用户只能执行该角色身份被授权的所有操作。


## 常见问题 {#section_vzj_pr8_guo .section}

Q：临时用户创建的集群或数据等，会随着临时用户的销毁而销毁吗？

A：通过临时用户创建的阿里云ES实例不会随着临时用户的销毁而销毁，并且临时用户对阿里云ES实例的修改也不会随着临时用户的销毁而还原，相当于行使主账号的权限进行操作。

