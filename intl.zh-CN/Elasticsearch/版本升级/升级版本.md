---
keyword: 升级es集群版本
---

# 升级版本

通过阿里云Elasticsearch的升级版本功能，您可以升级实例的版本或更新升级内核补丁，实现业务的无缝过渡。本文介绍如何升级实例版本，以及升级过程中的注意事项。

-   待升级的实例版本满足以下要求。

    |版本|开放限制|
    |--|----|
    |5.5.3 \> 5.6.16|无|
    |5.6.16 \> 6.3.2|白名单方式开放。如有需求请[提交工单](https://workorder-intl.console.aliyun.com/console.htm)咨询。|
    |6.3.2 \> 6.7.0|无|

-   完成版本升级前的检查。

    具体检查项，请参见[集群状态检查列表](#section_qb4_8ob_p09)和[5.6升级到6.3版本前的配置兼容性检查及调整方法](/intl.zh-CN/Elasticsearch/版本升级/5.6升级到6.3版本前的配置兼容性检查及调整方法.md)。

-   更新升级内核补丁：确保对应实例存在可更新的内核补丁。

    可在实例的[基本信息](/intl.zh-CN/Elasticsearch/管理实例/查看实例的基本信息.md)页面查看，如下图所示。

    ![有可更新的内核版本](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8646359951/p94038.png)

-   5.6.16版本升级至6.3.2版本：由于Elasticsearch 5.x与6.x存在部分不兼容的配置，如果您使用了这些配置，升级后可能会影响集群的使用，因此需要提前将集群配置为预期状态。详细信息，请参见[5.6升级到6.3版本前的配置兼容性检查及调整方法](/intl.zh-CN/Elasticsearch/版本升级/5.6升级到6.3版本前的配置兼容性检查及调整方法.md)。关于Elasticsearch 6.x的重大变更说明，请参见[Breaking changes in 6.0](https://www.elastic.co/guide/en/elasticsearch/reference/6.4/breaking-changes-6.0.html)。

    **说明：** 如果您通过[客户端](/intl.zh-CN/开发指南/通过客户端访问阿里云Elasticsearch.md)连接了待升级的集群，升级前，还需要更新客户端版本，确保客户端与集群版本的兼容性。关于兼容性的详细信息，请参见[Compatibility](https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-compatibility.html)。


## 注意事项

升级操作会触发实例重启，阿里云Elasticsearch支持两种重启方式。

|重启方式|原理|风险和建议|适用的版本升级方案|
|----|--|-----|---------|
|蓝绿变更重启|在集群中先增加高版本节点，再将低版本节点的数据迁移到高版本节点，最后删除低版本节点的方式进行重启。|-   升级操作无法取消，升级期间可以继续向集群写入数据或从集群读取数据，但不能进行其他变更操作，建议在流量低峰期进行。
-   节点的IP地址会发生变化。如果在集群配置或客户端访问集群的代码中指定了IP地址，需要在升级后，更新配置或代码。

|-   5.5.3 \> 5.6.16
-   6.3.2 \> 6.7.0
-   内核补丁更新升级 |
|全量重启|所有节点完全关闭后重启。|升级过程需要为集群[安装TLS证书](https://www.elastic.co/guide/en/elasticsearch/reference/current/ssl-tls.html)，会导致服务不可用。但不会造成数据丢失，升级持续时间主要与集群数据量和规格相关，建议提前规划好时间。**说明：** 全量重启后，集群节点的IP地址不会发生变化，因此您无需对实例进行配置变更。

|5.6.16 \> 6.3.2|

## 集群状态检查列表

在进行升级前，您需要检查集群是否处于正常状态，以及负载是否处于正常水位。只有当两者都正常时，才可以对实例进行升级。

|校验项|正常状态|
|---|----|
|集群健康度|集群状态正常（绿色）。|
|JVM使用率|集群JVM使用率低于75%。|
|磁盘使用率|节点的磁盘使用率低于cluster.routing.allocation.disk.watermark.low属性设置的值。|
|副本个数|所有索引都存在副本。|
|快照|集群在最近1个小时内完成过快照。|
|自定义插件|集群中不存在阿里云Elasticsearch预装之外的插件。|
|可用区ECS资源校验|可用区中ECS实例的库存充足。**说明：** 由于版本升级采用了先增加高版本节点，再将低版本节点的数据迁移到高版本节点，最后删除低版本节点的方式，因此升级前需要校验可用区中ECS实例的库存。 |
|YML文件|高版本的集群可以兼容低版本的配置。|

## 操作步骤

1.  登录[阿里云Elasticsearch控制台](https://elasticsearch.console.aliyun.com/#/home)。

2.  在左侧导航栏，单击**Elasticsearch实例**。

3.  在顶部菜单栏处，选择资源组和地域，然后在**实例列表**中单击目标实例ID。

4.  在**基本信息**页面，单击右侧的**更新与升级**。

5.  在**版本升级**对话框中，选择目标版本。

    **说明：** 更新内核补丁不会改变阿里云Elasticsearch实例的版本。当系统检测到内核有新特性发布时，才会显示内核补丁更新入口。内核更新到最新版本后，控制台将关闭更新入口，除非再次检测到有新特性发布。新特性的详细说明，请参见[内核版本发布记录](/intl.zh-CN/AliES内核/内核版本发布记录.md)。

6.  单击**升级检查**。

    系统会对配置兼容性、集群状态、集群快照备份以及基础资源进行检查。

    ![升级检查](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7646359951/p77587.png)

    检查完成后，请根据页面提示处理异常结果。具体说明如下：

    -   配置兼容检查

        检查升级前后两个版本是否有不兼容配置，尤其针对版本跨度较大的升级（例如5.x到6.x）。如果检查不通过，流程将终止。终止后，可查看对应的[检查项和解决方案](/intl.zh-CN/Elasticsearch/版本升级/5.6升级到6.3版本前的配置兼容性检查及调整方法.md)进行处理，然后重新进行升级操作。

    -   集群状态检查

        检查升级前集群状态是否为正常（Green）状态，以及负载是否符合检查要求。在检查前或检查失败时，可参见[集群状态检查列表](#section_qb4_8ob_p09)，检查集群负载是否处于正常水位。

    -   快照备份

        检查升级前的最近1个小时内是否完成过快照备份。如果最近1个小时内没有完成过快照备份，可以在**版本升级**页面单击**手动备份**，手动触发快照操作。

        **说明：** 当升级操作失败时，您可以通过备份的快照还原数据。快照备份所消耗的时间与集群数据量相关，如果集群未开启自动快照备份，且数据量较大，那么第一次快照时间会比较长。

7.  检查通过后，单击**开始升级**。

    升级期间，可在[任务列表](/intl.zh-CN/Elasticsearch/管理实例/查看实例任务进度详情.md)中查看升级进度。

    升级完成后，可在实例的**基本信息**页面，查看升级后的实例版本或内核版本。


